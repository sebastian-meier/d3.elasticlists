/*global d3:false *///EXTEND SO THAT DATA FIELDS can contain multiple values separated by comma as an option
var elasticLists=function(e){function h(e){c=e;i=c.node().getBoundingClientRect().width/f.columns.length;s=c.node().getBoundingClientRect().height;var t=0;for(var n in r){var o=c.append("div").attr("id","head-"+f.columns[t]).attr("class","el-head").attr("style","margin:0; padding:0; float:left; height:"+a+"px; width:"+100/f.columns.length+"%;").append("svg").attr("width",i).attr("height",a);o.append("rect").attr("height",a-5).attr("width",i-10).attr("x",0).attr("y",0);o.append("text").text(f.columns[t]).attr("x",5).attr("y",(a-5)/2+4);t++}t=0;for(var n in r){var l=c.append("div").attr("id","list-"+f.columns[t]).attr("data-column",f.columns[t]).attr("class","el-col").attr("style","margin:0; padding:0; float:left; height:"+(s-a)+"px; width:"+100/f.columns.length+"%;"),p=l.append("svg").attr("data-column",f.columns[t]).attr("id","svg-"+f.columns[t]).attr("height",u[t]);p.selectAll("rect.el-row").data(r[n]).enter().append("rect").attr("class",function(e){return"el-row el-count-"+e.count}).attr("x",0).attr("width",i-10);p.selectAll("text.el-text-left").data(r[n]).enter().append("text").attr("class",function(e){return"el-text el-text-left el-count-"+e.count}).attr("x",5);p.selectAll("text.el-text-right").data(r[n]).enter().append("text").attr("class",function(e){return"el-text el-text-right el-count-"+e.count}).attr("text-anchor","end").attr("x",i-15);p.selectAll("rect.el-click").data(r[n]).enter().append("rect").attr("class","el-click").attr("x",0).attr("width",i-10).on("click",function(e){h.changeFilter(d3.select(this.parentNode).attr("data-column"),e.name);h.update()});t++}h.update()}function p(e,t){var r=!1;for(var i in n[t])e.name===n[t][i]&&(r=!0);return r}function d(e){var t=!0;for(var r in n)if(n[r].length>=1){var i=!1;for(var s in n[r])if(f.multiples){var o=e[r].split(f.splitStr);for(var u in o)o[u]===n[r][s]&&(i=!0)}else e[r]===n[r][s]&&(i=!0);i||(t=!1)}return t}var t={id:"id",columns:[0],duration:500,multiples:!1,splitStr:","},n=[],r=[],i=0,s=0,o,u=[],a=40,f=d3.tools.extend(t,e);for(var l=0;l<f.columns.length;l++)n[f.columns[l]]=[];var c;h.update=function(){var e=0;for(var t in r){d3.select("#svg-"+f.columns[e]).transition().duration(f.duration).attr("height",u[e]);d3.selectAll("#svg-"+f.columns[e]+" rect.el-row").data(r[t]).attr("class",function(e){var t="";p(e,d3.select(this.parentNode).attr("data-column"))&&(t="el-selected ");return t+"el-row el-count-"+e.count}).transition().duration(f.duration).attr("y",function(e){return e.y}).attr("height",function(e){return o(e.count)});d3.selectAll("#svg-"+f.columns[e]+" text.el-text-left").data(r[t]).attr("class",function(e){return"el-text el-text-left el-count-"+e.count}).text(function(e){return e.name}).transition().duration(f.duration).attr("y",function(e){return e.y+o(e.count)/2+4});d3.selectAll("#svg-"+f.columns[e]+" text.el-text-right").data(r[t]).attr("class",function(e){return"el-text el-text-right el-count-"+e.count}).text(function(e){return e.count+"/"+e.ocount}).transition().duration(f.duration).attr("y",function(e,t){return e.y+o(e.count)/2+4});d3.selectAll("#svg-"+f.columns[e]+" rect.el-click").data(r[t]).transition().duration(f.duration).attr("y",function(e){return e.y}).attr("height",function(e){return o(e.count)});e++}};h.updateData=function(){for(var e=0;e<f.columns.length;e++){var t=[];for(var n=0;n<f.data.length;n++){var i=f.data[n][f.columns[e]],s=!1;for(var a in t)if(t[a].name===i){s=!0;d(f.data[n])&&t[a].count++;t[a].ocount++}if(!s){var l={name:i,count:0,ocount:0,y:0};d(f.data[n])&&(l.count=1);l.ocount=1;t.push(l)}}r[f.columns[e]]=t}for(var e in r)r[e].sort(function(e,t){return typeof e.name=="number"&&typeof t.name=="number"?e.name-t.name:e.name>t.name});var c=[];for(var e in r)for(var h in r[e])c.push(r[e][h].ocount);o=d3.scale.linear().domain(d3.extent(c)).range([20,60]);u=[];for(var e in r){var p=0;for(var h in r[e]){r[e][h].y=p;p+=o(r[e][h].count)+2}u.push(p)}for(var n=0;n<f.data.length;n++)d(f.data[n])?f.data[n].el_selected=!0:f.data[n].el_selected=!1;v.update(f.data)};h.changeFilter=function(e,t){var r=!0,i=[];for(var s in n[e])n[e][s]===t?r=!1:i.push(n[e][s]);r&&i.push(t);n[e]=i;h.updateData();return r};var v=d3.dispatch("update");d3.rebind(h,v,"on");return h};